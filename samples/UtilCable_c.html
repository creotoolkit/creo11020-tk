<html>
<head>
<title>UtilCable.c</title>
</head>
<body bgcolor="#ffffff">
<pre><a name="anchor-0"></a>
/*
	Copyright (c) 2024 PTC Inc. and/or Its Subsidiary Companies. All Rights Reserved.
*/

<a name="anchor-1"></a>
#include &lt;ProCabling.h>
#include &lt;ProCsys.h>

#include &quot;UtilCable.h&quot;
<a name="anchor-2"></a>
#include &quot;UtilString.h&quot;
#include &quot;TestError.h&quot;

/*---------------------------------------------------------------------------*\
<a name="anchor-3"></a>    Functions to manage wires, cables and bundless
\*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*\
  Function : ProCblWireHarnessesGet
  Purpose  : Retrieves pointers to the harnesses in the specified assembly 
<a name="anchor-4"></a>             that contain the specified wire.
\*---------------------------------------------------------------------------*/
ProError ProCblCableHarnessesGet (
    ProCblCable     *p_cable,        /* In: wire handle */
    ProCblHarness   **p_harnesses,  /* Out: ProArray of harnesses 
<a name="anchor-5"></a>                                       user must free memory by ProArrayFree */
    int             *har_num)        /* Out: harness number */
{
    int error;
    int i;
<a name="anchor-6"></a>    ProHarness *p_har_arr;
    ProMdlName name;
	ProError err;
    
    if (p_cable == NULL || p_harnesses == NULL)
<a name="anchor-7"></a>        return (PRO_TK_BAD_INPUTS);

	err = ProCableHarnessesGet(p_cable->p_owner->owner, p_cable->name, &amp;p_har_arr);

    TEST_CALL_REPORT(&quot;ProCableHarnessesGet&quot;, &quot;ProCblWireHarnessesGet&quot;,
<a name="anchor-8"></a>        (ProError)err, 0);
    if (err != PRO_TK_NO_ERROR)
        return (err);

	ProArraySizeGet(p_har_arr, har_num);
<a name="anchor-9"></a>    ProArrayAlloc (*har_num, sizeof (ProCblHarness), 1, (ProArray*)p_harnesses);
    for (i = 0; i &lt; *har_num; i++)
    {
        ProMdlMdlnameGet ((ProMdl)p_har_arr[i], name);
        ProCblHarnessInit ((ProPart)p_har_arr[i], name,
<a name="anchor-10"></a>            (ProAssembly)p_cable->p_owner->owner, 
            &amp;(*p_harnesses)[i]);
    }
    return (PRO_TK_NO_ERROR); 
}
<a name="anchor-11"></a>
/*---------------------------------------------------------------------------*\
  Function : ProCblCableLengthGet
  Purpose  : Retrieves the length of the specified wire
\*---------------------------------------------------------------------------*/
<a name="anchor-12"></a>ProError ProCblCableLengthGet (
    ProCblCable *p_wire,        /* In: wire handle */
    double     *p_length)      /* Out: wire length */
{
    ProError error;
<a name="anchor-13"></a>	ProCable cable;

    if (p_wire == NULL || p_length == NULL)
        return (PRO_TK_BAD_INPUTS);

<a name="anchor-14"></a>	error = ProCableByNameGet(p_wire->p_owner->harness, p_wire->name, &amp;cable);
	error = ProCableLengthGet(&amp;cable, p_length);

    TEST_CALL_REPORT(&quot;procbl_get_wire_length&quot;, &quot;ProCblWireLengthGet&quot;,
        (ProError)error, 0);
<a name="anchor-15"></a>    if (!error)
        return (PRO_TK_GENERAL_ERROR);
    return (PRO_TK_NO_ERROR);
}

<a name="anchor-16"></a>/*---------------------------------------------------------------------------*\
  Function : ProCblCableInit
  Purpose  : Initialize cable structure
\*---------------------------------------------------------------------------*/
ProError ProCblCableInit (
<a name="anchor-17"></a>    int            id,              /* In: cable's id */
    ProName        name,            /* In: cable's name */
    ProCblHarness  *p_owner,        /* In: cable's owner */
    ProCblCable    *p_cable)        /* Out:cable's handle to init*/
{
<a name="anchor-18"></a>	ProError error = PRO_TK_NO_ERROR;
	ProCable cable;

	if (p_cable == NULL || (id == -1 &amp;&amp; name == NULL))
		return (PRO_TK_BAD_INPUTS);
<a name="anchor-19"></a>	if (id == -1)
	{
		error = ProCableByNameGet(p_owner->harness, name, &amp;cable);
		p_cable->id = cable.id;
		TEST_CALL_REPORT(&quot;procbl_get_cable_id&quot;, &quot;ProCblCableInit&quot;,
<a name="anchor-20"></a>			(ProError)error, 0);
	}
	else	
		p_cable->id = id;
	if (name == NULL)
<a name="anchor-21"></a>	{
      ProName buff;
		error = ProModelitemInit(p_owner->harness, id, PRO_CABLE, &amp;cable);
		error = ProCableNameGet(&amp;cable, buff);
		TEST_CALL_REPORT(&quot;procbl_get_cable_name&quot;, &quot;ProCblCableInit&quot;,
<a name="anchor-22"></a>			(ProError)error, 0);
	}
	else
		ProUtilWstrcpy (p_cable->name, name);
	p_cable->p_owner = p_owner;
<a name="anchor-23"></a>	return (error ==0 ? PRO_TK_NO_ERROR : PRO_TK_GENERAL_ERROR);
}

/*---------------------------------------------------------------------------*\
  Function : ProCblCableNameGet
<a name="anchor-24"></a>  Purpose  : Retrieves cable name
\*---------------------------------------------------------------------------*/
ProError ProCblCableNameGet (
    ProCblCable    *p_cable,        /* In: cable's handle*/
    ProName        name)            /* Out:cable's name */
<a name="anchor-25"></a>{
    if (p_cable == NULL)
        return (PRO_TK_BAD_INPUTS);
    ProUtilWstrcpy(name, p_cable->name);
    return (PRO_TK_NO_ERROR);
<a name="anchor-26"></a>}

/*---------------------------------------------------------------------------*\
  Function : ProCblCableIdGet
  Purpose  : Retrieves cable id
<a name="anchor-27"></a>\*---------------------------------------------------------------------------*/
ProError ProCblCableIdGet (
    ProCblCable    *p_cable,        /* In: cable's handle*/
    int            *p_id)           /* Out:cable's id */
{
<a name="anchor-28"></a>    if (p_cable == NULL || p_id == NULL)
        return (PRO_TK_BAD_INPUTS);
    *p_id = p_cable->id;
    return (PRO_TK_NO_ERROR);
}
<a name="anchor-29"></a>
/*---------------------------------------------------------------------------*\
  Function : ProCblCableTypeGet
  Purpose  : Retrieves cable type
\*---------------------------------------------------------------------------*/
<a name="anchor-30"></a>ProError ProCblCableTypeGet (
    ProCblCable   *p_cable,     /* in: cable handle */
    ProCableType *p_type)    /* Out: cable type */
{
    ProError error;
<a name="anchor-31"></a>	ProCable cable;

    if (p_cable == NULL || p_type == NULL)
        return (PRO_TK_BAD_INPUTS);

<a name="anchor-32"></a>	error = ProCableByNameGet(p_cable->p_owner->harness, p_cable->name, &amp;cable);
    error = ProCableTypeGet(&amp;cable, p_type);
    TEST_CALL_REPORT(&quot;procbl_get_cable_subtype&quot;, &quot;Procbl_cable_typeGet&quot;,
        (ProError)error, 0);
    if (error != PRO_TK_NO_ERROR)
<a name="anchor-33"></a>        return (PRO_TK_GENERAL_ERROR);
    return (PRO_TK_NO_ERROR);
}


<a name="anchor-34"></a>/*---------------------------------------------------------------------------*\
  Function : ProCblCableCreate
  Purpose  : Creates new cable or wire in specified harness
\*---------------------------------------------------------------------------*/
ProError ProCblCableCreate (
<a name="anchor-35"></a>    ProCblHarness  *p_harness,      /* In: harness's handle*/
    ProCblSpool    *p_spool,	    /* In: spool's name */
    ProName        cable_name,      /* In: cable's name */
    ProCblCable    *p_cable)        /* Out:Handle of new cable*/
{
<a name="anchor-36"></a>	int error;
	ProError status;
	int cable_id;
	ProName w_spool_name;
	ProCable cable;
<a name="anchor-37"></a>
	if (p_harness == NULL || p_cable == NULL)
		return (PRO_TK_BAD_INPUTS);

	status = ProCblSpoolNameGet(p_spool, w_spool_name);
<a name="anchor-38"></a>	TEST_CALL_REPORT(&quot;ProCblSpoolNameGet&quot;, &quot;ProCblCableCreate&quot;,
		status, status != PRO_TK_NO_ERROR);

	status = ProCableCreate(p_harness->harness, (ProSpool*)p_spool, cable_name, &amp;cable);
	TEST_CALL_REPORT(&quot;procbl_create_cable&quot;, &quot;ProCblCableCreate&quot;,
<a name="anchor-39"></a>		(ProError)status, 0);
	if (status != PRO_TK_NO_ERROR)
		return (status);

	status = ProCblCableInit (cable.id, cable_name, p_harness, p_cable);
<a name="anchor-40"></a>
	return (status);
}

/*---------------------------------------------------------------------------*\
<a name="anchor-41"></a>  Function : ProCblBundleCreate
    Purpose  : Creates new bundle in specified harness
\*---------------------------------------------------------------------------*/
ProError ProCblBundleCreate (
    ProCblHarness  *p_harness,      /* In: harness's handle*/
<a name="anchor-42"></a>    ProCblSpool    *p_spool,	    /* In: spool's name */
    ProName        bundle_name,     /* In: bundle's name */
    int            cable_num,       /* In: cable num */
    ProCblCable    *p_cables,       /* In: the array of cables
                                           to add */
<a name="anchor-43"></a>    ProBoolean     bundle_type,     /* In: TRUE=flat, FALSE=round */
    ProCblBundle   *p_bundle)       /* Out:Handle of new bundle*/
{
    ProError status;
    int error;
<a name="anchor-44"></a>    int cable_id, i;
    ProName *cable_names;
    ProName w_spool_name;
	ProCable bundle;
	ProCable *cables;
<a name="anchor-45"></a>
    if (p_harness == NULL || p_cables == NULL || p_bundle == NULL)
        return (PRO_TK_BAD_INPUTS);

    status = ProCblSpoolNameGet(p_spool, w_spool_name);
<a name="anchor-46"></a>    TEST_CALL_REPORT(&quot;ProCblSpoolNameGet&quot;, &quot;ProCblBundleCreate&quot;,
				    status, status != PRO_TK_NO_ERROR);
    status = ProArrayAlloc (0, sizeof (ProName), 1, 
        (ProArray*)&amp;cable_names);
    for (i = 0; i &lt; cable_num; i++)
<a name="anchor-47"></a>        status = ProArrayObjectAdd ((ProArray*)&amp;cable_names, PRO_VALUE_UNUSED,
            1, p_cables[i].name);

	status = ProArrayAlloc(0, sizeof(ProCable), 1, (ProArray*)&amp;cables);
	for(i = 0; i &lt; cable_num; i++)
<a name="anchor-48"></a>	{
		ProModelitem item;
		status = ProModelitemInit(p_cables->p_owner->harness, p_cables->id, PRO_CABLE, &amp;item);
		status = ProArrayObjectAdd ((ProArray*)&amp;cables, PRO_VALUE_UNUSED, 1, &amp;item);
	}
<a name="anchor-49"></a>	status = ProBundleCreate(p_harness->harness, (ProSpool*)p_spool, bundle_name, 
		cables, bundle_type, &amp;bundle);
    TEST_CALL_REPORT(&quot;procbl_create_bundle&quot;, &quot;ProCblBundleCreate&quot;,
						(ProError)status, 0);

<a name="anchor-50"></a>	status = ProCableNameGet(&amp;bundle, bundle_name);
    TEST_CALL_REPORT(&quot;procbl_get_cable_name&quot;, &quot;ProCblBundleCreate&quot;,
						(ProError)status, 0);

    status = ProArrayFree ((ProArray*)&amp;cable_names);
<a name="anchor-51"></a>	status = ProArrayFree ((ProArray*)&amp;cables);

    if (status != PRO_TK_NO_ERROR)
        return (status);

<a name="anchor-52"></a>    status = ProCblCableInit (bundle.id, bundle_name,
        p_harness, (ProCblCable*)p_bundle); 

    return (PRO_TK_NO_ERROR);
}
<a name="anchor-53"></a>
/*---------------------------------------------------------------------------*\
  Function : ProCblBundleCablesGet
  Purpose  : Retrieves one parameter for the specified cable
\*---------------------------------------------------------------------------*/
<a name="anchor-54"></a>ProError ProCblBundleCablesGet (
    ProCblBundle   *p_bundle,       /* In: bundle handle */
    ProBundleCableLevel level,      /* In: level:
                                       -1   collect all cables
                                        1   retrieve all cables included
<a name="anchor-55"></a>                                            in the input bundle
                                        2   retrieve all cables included
                                            in the first level bundle */
    ProCblCable    **p_cables,      /* Out: ProArray of cables handles
                                       User must free mem using ProArrayFree*/
<a name="anchor-56"></a>    int            *p_n_cables)       /* Out: cables number */
{
    int error, i, cable_id;
    ProName *p_cables_names;
	ProError status;
<a name="anchor-57"></a>	ProCable bundle;
	ProCable* cables;

    if (p_bundle == NULL || p_cables == NULL || p_n_cables == NULL)
        return (PRO_TK_BAD_INPUTS);
<a name="anchor-58"></a>
	status = ProCableByNameGet(p_bundle->p_owner->harness, p_bundle->name, &amp;bundle);
	status = ProBundleCablesCollect(&amp;bundle, level, &amp;cables);
    TEST_CALL_REPORT(&quot;procbl_get_bundle_cables&quot;, &quot;ProCblBundleCablesGet&quot;,
        (ProError)status, 0);
<a name="anchor-59"></a>
    if (status != PRO_TK_NO_ERROR)
        return (status);

	ProArraySizeGet(cables, p_n_cables);
<a name="anchor-60"></a>
    ProArrayAlloc (*p_n_cables, sizeof (ProCblCable), 1, (ProArray*)p_cables);
    for (i = 0; i &lt; *p_n_cables; i++)
    {
		ProName cable_name;
<a name="anchor-61"></a>		status = ProCableNameGet(&amp;cables[i], cable_name);
		TEST_CALL_REPORT(&quot;procbl_get_cable_id&quot;, &quot;ProCblBundleCablesGet&quot;,
        (ProError)status, 0);
        if (status != PRO_TK_NO_ERROR)
            break;
<a name="anchor-62"></a>        ProCblCableInit (cables[i].id, cable_name, p_bundle->p_owner,
            &amp;(*p_cables)[i]);
    }
    if (status != PRO_TK_NO_ERROR)
    {
<a name="anchor-63"></a>        ProArrayFree ((ProArray*)p_cables);
        return (PRO_TK_GENERAL_ERROR);
    }
    return (PRO_TK_NO_ERROR);
}
<a name="anchor-64"></a>
/*---------------------------------------------------------------------------*\
  Function : ProCblCableParameterGet
  Purpose  : Retrieves one parameter for the specified cable
\*---------------------------------------------------------------------------*/
<a name="anchor-65"></a>ProError ProCblCableParameterGet (
    ProCblCable    *p_cable,        /* In: cable's handle*/
    ProName        param_name,      /* In: parameter's name */
    ProCableparam *p_param_info) /* Out: parameter's info */
{
<a name="anchor-66"></a>    ProError error;
	ProCable cable;

    if (p_cable == NULL)
        return (PRO_TK_BAD_INPUTS);
<a name="anchor-67"></a>
	error = ProModelitemInit(p_cable->p_owner->harness, p_cable->id, PRO_CABLE, &amp;cable);
	error = ProCableParameterGet(p_cable->p_owner->owner, &amp;cable, param_name, p_param_info);
    TEST_CALL_REPORT(&quot;procbl_get_cable_param&quot;, &quot;ProCblCableParameterGet&quot;,
    (ProError)error, 0);
<a name="anchor-68"></a>    if (error != PRO_TK_NO_ERROR)
        return (error);

	return (PRO_TK_NO_ERROR);
}
<a name="anchor-69"></a>

/*---------------------------------------------------------------------------*\
  Function : ProCblCableParameterDelete
  Purpose  : Deletes one parameter for specified cable
<a name="anchor-70"></a>\*---------------------------------------------------------------------------*/
ProError ProCblCableParameterDelete (
    ProCblCable    *p_cable,        /* In: cable's handle*/
    ProName        param_name)      /* In: parameter's name*/
{
<a name="anchor-71"></a>    ProError error;
	ProCable cable;

    if (p_cable == NULL)
        return (PRO_TK_BAD_INPUTS);
<a name="anchor-72"></a>
	error = ProModelitemInit(p_cable->p_owner->harness, p_cable->id, PRO_CABLE, &amp;cable);
	error = ProCableParameterDelete(p_cable->p_owner->owner, &amp;cable, param_name);
    TEST_CALL_REPORT(&quot;procbl_delete_cable_param&quot;, &quot;ProCblCableParameterDelete&quot;,
    (ProError)error, 0);
<a name="anchor-73"></a>    if (error != PRO_TK_NO_ERROR)
        return (error);

    return (PRO_TK_NO_ERROR);
}
<a name="anchor-74"></a>
/*---------------------------------------------------------------------------*\
  Function : ProCblCableParametersGet
  Purpose  : Retrieves the parameters, including all values associated with
             multivalued parameters, for the specified cable
<a name="anchor-75"></a>\*---------------------------------------------------------------------------*/
ProError ProCblCableParametersGet (
    ProCblCable          *p_cable,       /* In: cable's handle*/
    ProCableparam **p_params_info) /* Out: ProArray of parameters */
{
<a name="anchor-76"></a>    ProError error;
	ProCable cable;

    if (p_cable == NULL)
        return (PRO_TK_BAD_INPUTS);
<a name="anchor-77"></a>
	error = ProModelitemInit(p_cable->p_owner->harness, p_cable->id, PRO_CABLE, &amp;cable);
	error = ProCableParametersCollect(p_cable->p_owner->owner, &amp;cable, p_params_info);
    TEST_CALL_REPORT(&quot;procbl_get_cable_params&quot;, &quot;ProCblCableParametersGet&quot;,
    (ProError)error, 0);
<a name="anchor-78"></a>    if (error != PRO_TK_NO_ERROR)
        return (error);

	return (PRO_TK_NO_ERROR);
}
<a name="anchor-79"></a>
/*---------------------------------------------------------------------------*\
  Function : ProCblCableParametersSet
  Purpose  : Sets parameters for the specified cable
\*---------------------------------------------------------------------------*/
<a name="anchor-80"></a>ProError ProCblCableParametersSet (
    ProCblCable         *p_cable,       /* In: cable's handle*/
	ProCableparam *p_params_info )	/* In: array of parameters */
{
    ProError error;
<a name="anchor-81"></a>	ProCable cable;

    if (p_cable == NULL)
        return (PRO_TK_BAD_INPUTS);

<a name="anchor-82"></a>	error = ProModelitemInit(p_cable->p_owner->harness, p_cable->id, PRO_CABLE, &amp;cable);
	error = ProCableParametersSet(p_cable->p_owner->owner, &amp;cable, p_params_info);
    TEST_CALL_REPORT(&quot;procbl_set_cable_params&quot;, &quot;ProCblCableParametersSet&quot;,
    (ProError)error, 0);
    if (error != PRO_TK_NO_ERROR)
<a name="anchor-83"></a>        return (error);


    return (PRO_TK_NO_ERROR);
}
<a name="anchor-84"></a>
/*---------------------------------------------------------------------------*\
  Function : ProCblCableLogicalEndsGet
  Purpose  : Retrieves logical ends of specified cable
\*---------------------------------------------------------------------------*/
<a name="anchor-85"></a>ProError ProCblCableLogicalEndsGet (
    ProCblCable    *p_cable,        /* In: cable's handle*/
    ProSelection*	   end1,
	ProSelection*	   end2)        /* Out: The entry ports */
{
<a name="anchor-86"></a>    ProError error;
	ProCable cable;

    if (p_cable == NULL)
        return (PRO_TK_BAD_INPUTS);
<a name="anchor-87"></a>
	error = ProModelitemInit(p_cable->p_owner->harness, p_cable->id, PRO_CABLE, &amp;cable);
	error = ProCableLogicalEndsGet(p_cable->p_owner->owner, &amp;cable, end1, end2);
    TEST_CALL_REPORT(&quot;procbl_get_cable_logical_ends&quot;, 
               &quot;ProCblCableLogicalEndsGet&quot;,(ProError)error, 0);
<a name="anchor-88"></a>    if (error != PRO_TK_NO_ERROR)
        return (error);

    return (PRO_TK_NO_ERROR);
}
<a name="anchor-89"></a>
/*---------------------------------------------------------------------------*\
  Function : ProCblCablesFromLogicalCreate
  Purpose  : Creates cables from logical
             If corresponding spools are not created they are also created by
<a name="anchor-90"></a>             this func.
\*---------------------------------------------------------------------------*/
ProError ProCblCablesFromLogicalCreate (
    ProCblHarness  *p_harness,      /* In: harness's handle*/
    int            cable_num,       /* In: the number of cables to create */
<a name="anchor-91"></a>    ProName        *p_cable_names)  /* In: cables names */
{
    ProError status;
    int error, i; 
    ProName *prodev_names;
<a name="anchor-92"></a>
    if (p_harness == NULL || p_cable_names == NULL)
        return (PRO_TK_BAD_INPUTS);
    status = ProArrayAlloc (0, sizeof (ProName), 1, 
        (ProArray*)&amp;prodev_names);
<a name="anchor-93"></a>    for (i = 0; i &lt; cable_num; i++)
        status = ProArrayObjectAdd ((ProArray*)&amp;prodev_names, 
            PRO_VALUE_UNUSED, 1, p_cable_names[i]);

	status = ProCablesFromLogicalCreate(p_harness->owner, p_harness->harness, prodev_names);
<a name="anchor-94"></a>    TEST_CALL_REPORT(&quot;procbl_create_cables_from_logical&quot;, 
               &quot;ProCblCablesFromLogicalCreate&quot;,(ProError)status, 0);
    status = ProArrayFree ((ProArray*)&amp;prodev_names);

    if (status != PRO_TK_NO_ERROR)
<a name="anchor-95"></a>        return (status);

    return (PRO_TK_NO_ERROR); 
}

<a name="anchor-96"></a>/*---------------------------------------------------------------------------*\
  Function : ProCblCablesFromLogicalGet
  Purpose  : Returns list of imported but not created cables
\*---------------------------------------------------------------------------*/
ProError ProCblCablesFromLogicalGet (
<a name="anchor-97"></a>    ProAssembly    asm_mdl,         /* In: assembly's handle*/
    ProName        **p_cable_names, /* Out: ProArray of cable names */
    int *cable_num)                 /* Out: cables number */
{
    ProError status;
<a name="anchor-98"></a>    int error, i;
    ProName *prodev_names;

    if (asm_mdl == NULL)
        return (PRO_TK_BAD_INPUTS);
<a name="anchor-99"></a>
	status = ProCablesFromLogicalGet(asm_mdl, &amp;prodev_names);
    TEST_CALL_REPORT(&quot;procbl_get_cables_from_logical&quot;, 
               &quot;ProCblCablesFromLogicalGet&quot;,(ProError)status, 0);
    if (status != PRO_TK_NO_ERROR)
<a name="anchor-100"></a>        return (status);
	
	ProArraySizeGet(prodev_names, cable_num);

	status = ProArrayAlloc (0, sizeof (ProName), 1, (ProArray*)p_cable_names);
<a name="anchor-101"></a>    if (status != PRO_TK_NO_ERROR)
        return (PRO_TK_GENERAL_ERROR);
    
	for (i = 0; i &lt; *cable_num; i++)
        status = ProArrayObjectAdd ((ProArray*)p_cable_names, 
<a name="anchor-102"></a>            PRO_VALUE_UNUSED, 1, prodev_names[i]);
    
    return (status);
}

<a name="anchor-103"></a>/*---------------------------------------------------------------------------*\
  Function : ProCblCableLocationsGet
  Purpose  : Finds the locations for the specified cable or wire
\*---------------------------------------------------------------------------*/
ProError ProCblCableLocationsGet (
<a name="anchor-104"></a>    ProCblCable  *p_cable,             /* In: cable handle */
    int          **p_location_array,   /* Out: ProArray of locations ids */
    int          *n_locations)         /* Out: Locations number */
{
    ProError error;
<a name="anchor-105"></a>	int i;
    int *p_locations;
	ProCable cable;
	ProCablelocation* p_cable_loc_array;
    
<a name="anchor-106"></a>    if (p_cable == NULL || p_location_array == NULL || n_locations == NULL)
        return (PRO_TK_BAD_INPUTS);

	error = ProModelitemInit(p_cable->p_owner->harness, p_cable->id, PRO_CABLE, &amp;cable);
	error = ProCableLocationsCollect(p_cable->p_owner->owner, &amp;cable, &amp;p_cable_loc_array);
<a name="anchor-107"></a>    TEST_CALL_REPORT(&quot;procbl_get_cable_locations&quot;, 
               &quot;ProCblCableLocationsGet&quot;,(ProError)error, 0);
    if (error != PRO_TK_NO_ERROR)
        return (error);

<a name="anchor-108"></a>	ProArraySizeGet(p_cable_loc_array, n_locations);

    ProArrayAlloc (*n_locations, sizeof (int), 1, (ProArray*)p_location_array);
    for (i = 0; i &lt; *n_locations; i++)
        (*p_location_array)[i] = p_cable_loc_array[i].id;
<a name="anchor-109"></a>
    return (PRO_TK_NO_ERROR);
}

/*---------------------------------------------------------------------------*\
<a name="anchor-110"></a>  Function : ProCblLocationCablesGet
  Purpose  : Find cables at the specified location
\*---------------------------------------------------------------------------*/
ProError ProCblLocationCablesGet (
    ProCblHarness  *p_harness,             /* In: harness handle */
<a name="anchor-111"></a>    int            loc_id,                 /* In: location id */
    ProCblCable    **p_cables,             /* Out: ProArray of cables handles*/
    int            *p_n_cables)            /* Out: cables num */
{
    int error, i, cable_id;
<a name="anchor-112"></a>    ProName *p_cable_names;
	ProError status;
	ProCablelocation p_loc;
	ProCable* cables;

<a name="anchor-113"></a>    if (p_cables == NULL || p_harness == NULL || p_n_cables == NULL)
        return (PRO_TK_BAD_INPUTS);

	status = ProModelitemInit(p_harness->harness, loc_id, PRO_CABLE_LOCATION, &amp;p_loc);
	status = ProCablelocationCablesGet(&amp;p_loc, &amp;cables);
<a name="anchor-114"></a>
	ProArraySizeGet(cables, p_n_cables);

    TEST_CALL_REPORT(&quot;procbl_get_location_cables&quot;, 
               &quot;ProCblLocationCablesGet&quot;,(ProError)status, 0);
<a name="anchor-115"></a>    if (status != PRO_TK_NO_ERROR)
        return (status);
    ProArrayAlloc (*p_n_cables, sizeof (ProCblCable), 1, 
        (ProArray*)p_cables);
    for (i = 0; i &lt; *p_n_cables; i++)
<a name="anchor-116"></a>    {
		ProName cable_name;

		status = ProCableNameGet(&amp;cables[i], cable_name);
        TEST_CALL_REPORT(&quot;procbl_get_cable_id&quot;, 
<a name="anchor-117"></a>            &quot;ProCblLocationCablesGet&quot;,(ProError)status, 0);
        if (status != PRO_TK_NO_ERROR)
            break;
        ProCblCableInit (cables[i].id, cable_name, p_harness,
            &amp;(*p_cables)[i]);
<a name="anchor-118"></a>    }
    if (status != PRO_TK_NO_ERROR)
    {
        ProArrayFree ((ProArray*)p_cables);
        return (PRO_TK_GENERAL_ERROR);
<a name="anchor-119"></a>    }
    return (PRO_TK_NO_ERROR);
}

/*---------------------------------------------------------------------------*\
<a name="anchor-120"></a>  Function : ProCblCableGeomGet
  Purpose  : Retrieves cable geometry
\*---------------------------------------------------------------------------*/
ProError ProCblCableGeomGet (
    ProCblCable    *p_cable,           /* In: cable handle */
<a name="anchor-121"></a>    ProCablesegment  **p_segs)     /* Out: cable geom */
                                       /* The function allocates the memory for
                     this argument, and reuses it on subsequent calls.
                     You should not free the memory or keep a pointer to it.*/
{
<a name="anchor-122"></a>    ProError error;
	ProCable cable;

    if (p_cable == NULL || p_segs ==  NULL)
        return (PRO_TK_BAD_INPUTS);
<a name="anchor-123"></a>
	error = ProModelitemInit(p_cable->p_owner->harness, p_cable->id, PRO_CABLE, &amp;cable);

	error = ProCableSegmentsGet(&amp;cable, p_segs);
	
<a name="anchor-124"></a>    TEST_CALL_REPORT(&quot;procbl_get_cable_geom &quot;, 
               &quot;ProCblCableGeomGet&quot;,(ProError)error, 0);
    if (error != 0)
        return (PRO_TK_GENERAL_ERROR);
    return (PRO_TK_NO_ERROR);
<a name="anchor-125"></a>}

/*---------------------------------------------------------------------------*\
  Function : ProCblCableClearance
  Purpose  : Determines the clearance of the specified cable, and reports if
<a name="anchor-126"></a>             interference was found
\*---------------------------------------------------------------------------*/
ProError ProCblCableClearance (
    ProSelection      sel1,        /* In: first selection */
    ProSelection      sel2,        /* In: second selection */
<a name="anchor-127"></a>    ProBoolean   *interference,    /* Out: interference */
    ProPoint3d      pnt_arr[2])    /* Out: The coordinates of the closest 
                                      points*/
{
    ProError error;
<a name="anchor-128"></a>    ProBoolean interf;

    if (interference == NULL)
        return (PRO_TK_BAD_INPUTS);
        
<a name="anchor-129"></a>	error = ProCableClearanceCompute(sel1, sel2, &amp;interf, pnt_arr);
    TEST_CALL_REPORT(&quot;procbl_cable_clearance&quot;, 
               &quot;ProCblCableClearance&quot;,(ProError)error, 0);
    if (error != PRO_TK_NO_ERROR)
        return (PRO_TK_GENERAL_ERROR);
<a name="anchor-130"></a>    if (interf == 1)
        *interference = PRO_B_FALSE;
    else
        *interference = PRO_B_TRUE;
    return (PRO_TK_NO_ERROR);
<a name="anchor-131"></a>}

/*---------------------------------------------------------------------------*\
    Functions to manage connectors
\*---------------------------------------------------------------------------*/
<a name="anchor-132"></a>
/*---------------------------------------------------------------------------*\
  Function : ProCblConnectorInit
  Purpose  : Initializes connector structure
\*---------------------------------------------------------------------------*/
<a name="anchor-133"></a>ProError ProCblConnectorInit (
    ProAsmcomppath  *path,	     /* In : Assembly component path */
    ProCblConnector   *p_connector)  /* Out: pointer to connector
                                        structure to initialize */
{
<a name="anchor-134"></a>	int i, j, ierr, **p_comp_id_tab, *p_table_num, num_connectors = 0;
	ProError err;
	ProConnector* p_cons;

	if (!path)
<a name="anchor-135"></a>		return (PRO_TK_BAD_INPUTS);
	*p_connector = *(ProCblConnector*)path;

    ierr = ProAssemblyConnectorsGet((ProAssembly)path->owner, &amp;p_cons);
    TEST_CALL_REPORT(&quot;procbl_get_assy_connectors&quot;, 
<a name="anchor-136"></a>		&quot;ProCblConnectorInit&quot;, (ProError)ierr, 0);

    ProArraySizeGet (p_cons,&amp;num_connectors);
    for (i=0; i&lt;num_connectors; i++)
    {
<a name="anchor-137"></a>	  for (j=0; j&lt;p_cons[i].table_num; j++)
	    if (path->comp_id_table[j] != p_cons[i].comp_id_table[j])
		  break;

      if (j>=p_cons[i].table_num)	
<a name="anchor-138"></a>	    break;
    }

    TEST_CALL_REPORT(&quot;pro_release_memb_id_tab&quot;, 
		&quot;ProCblConnectorInit&quot;, (ProError)0, 0);
<a name="anchor-139"></a>    if (i&lt;num_connectors)
	  return (PRO_TK_NO_ERROR);
    else
	  return (PRO_TK_E_NOT_FOUND);
}
<a name="anchor-140"></a>
/*---------------------------------------------------------------------------*\
  Function : ProCblConnectorParameterGet
  Purpose  : Gets connector parameter
\*---------------------------------------------------------------------------*/
<a name="anchor-141"></a>ProError ProCblConnectorParameterGet (
    ProCblConnector     *p_connector, /* In : Connector's handle */
    ProName              w_param_name,/* In : Parameter's name */
    ProCableparam *p_param)     /* Out: Parameter's handle */
{
<a name="anchor-142"></a>    ProError error;

    if (p_connector == NULL || p_param == NULL)
        return (PRO_TK_BAD_INPUTS);

<a name="anchor-143"></a>	error = ProConnectorParamGet(p_connector, w_param_name, p_param);
    TEST_CALL_REPORT(&quot;procbl_get_connector_param&quot;, 
          &quot;ProCblConnectorParameterGet&quot;,(ProError)error, 0);
	if (error != PRO_TK_NO_ERROR)
		return (PRO_TK_GENERAL_ERROR);
<a name="anchor-144"></a>    return (PRO_TK_NO_ERROR);
}

/*---------------------------------------------------------------------------*\
  Function : ProCblConnectorParameterDelete
<a name="anchor-145"></a>  Purpose  : Deletes parameter of specified connector
\*---------------------------------------------------------------------------*/
ProError ProCblConnectorParameterDelete (
    ProCblConnector   *p_connector,     /* In : Connector's handle*/
    ProName            w_param_name)    /* In : Parameter name */
<a name="anchor-146"></a>{
    ProError error;

    if (p_connector == NULL)
        return (PRO_TK_BAD_INPUTS);
<a name="anchor-147"></a>
	error = ProConnectorParamDelete(p_connector, w_param_name);
    TEST_CALL_REPORT(&quot;procbl_delete_connector_param &quot;, 
          &quot;ProCblConnectorParameterDelete&quot;,(ProError)error, 0);
	if (error != PRO_TK_NO_ERROR)
<a name="anchor-148"></a>		return (PRO_TK_GENERAL_ERROR);
    return (PRO_TK_NO_ERROR);
}

/*---------------------------------------------------------------------------*\
<a name="anchor-149"></a>  Function : ProCblConnectorParametersGet
  Purpose  : Retrives parameters of specified connector
\*---------------------------------------------------------------------------*/
ProError ProCblConnectorParametersGet (
    ProCblConnector      *p_connector,/* In : connector's handle*/
<a name="anchor-150"></a>    ProCableparam **p_param)    /* Out: ProArray of params*/

{
	ProError error;

<a name="anchor-151"></a>	if (p_connector == NULL)
		return (PRO_TK_BAD_INPUTS);

	error = ProConnectorParamsCollect(p_connector, p_param);
	TEST_CALL_REPORT(&quot;procbl_get_connector_params&quot;, 
<a name="anchor-152"></a>		&quot;ProCblConnectorParametersGet&quot;,(ProError)error, 0);
	if (error != PRO_TK_NO_ERROR)
		return (PRO_TK_GENERAL_ERROR);
	return (PRO_TK_NO_ERROR);
}
<a name="anchor-153"></a>
/*---------------------------------------------------------------------------*\
  Function : ProCblConnectorParametersSet
  Purpose  : Sets parameter of specified connector
\*---------------------------------------------------------------------------*/
<a name="anchor-154"></a>ProError ProCblConnectorParametersSet (
    ProCblConnector *p_connector,  /* In : connector's handle*/
    ProCableparam *p_param)  /* In : handles of parameter's*/
{
    ProError error;
<a name="anchor-155"></a>
    if (p_connector == NULL)
        return (PRO_TK_BAD_INPUTS);

	error = ProConnectorParamsSet(p_connector, p_param);
<a name="anchor-156"></a>    TEST_CALL_REPORT(&quot;procbl_set_connector_params &quot;, 
          &quot;ProCblConnectorParametersSet&quot;,(ProError)error, 0);
    if (error != PRO_TK_NO_ERROR)
        return (error);

<a name="anchor-157"></a>    return (PRO_TK_NO_ERROR);
}

/*---------------------------------------------------------------------------*\
  Function : ProCblConnectorFromLogical
<a name="anchor-158"></a>  Purpose  : Returns list of imported, but not designated connectors
\*---------------------------------------------------------------------------*/
ProError ProCblConnectorFromLogical (
    ProAssembly asm_mdl,        /* In : The cabling  assembly's handle */
    ProName    **p_w_name,      /* Out: list of log. con. ProArray, 
<a name="anchor-159"></a>                                        to free call ProArrayFree */
    int *con_num)               /* Out: number of connectores */
{
	ProError status;
	int error, i;
<a name="anchor-160"></a>	ProName *con_names;

	if (asm_mdl == NULL)
		return (PRO_TK_BAD_INPUTS);

<a name="anchor-161"></a>	status = ProConnectorsFromLogicalGet(asm_mdl, p_w_name);
	TEST_CALL_REPORT(&quot;procbl_get_connectors_from_logical&quot;, 
		&quot;ProCblConnectorFromLogical&quot;,(ProError)status, 0);
	if (status != PRO_TK_NO_ERROR)
		return (status);
<a name="anchor-162"></a>
	ProArraySizeGet(*p_w_name, con_num);

	return (PRO_TK_NO_ERROR);
}
<a name="anchor-163"></a>
/*---------------------------------------------------------------------------*\
  Function : ProCblAssemblyConnectorsGet
  Purpose  : Collect all designated connectors 
\*---------------------------------------------------------------------------*/
<a name="anchor-164"></a>ProError ProCblAssemblyConnectorsGet (
    ProAssembly       assy,    /* In: The handle of cabling's assembly. */
    ProCblConnector **p_cons,  /* Out: ProArray of connectors if successfull,
                                       to free call ProArrayFree */
    int              *num_cons)/* Out: Number of retrieved connectors*/
<a name="anchor-165"></a>{
    int error, i, j, **p_ids_tab_array, *p_nums_array;
	ProError status;

    if (assy == NULL || p_cons == NULL)
<a name="anchor-166"></a>        return (PRO_TK_BAD_INPUTS);

	status = ProAssemblyConnectorsGet(assy, (ProConnector**)p_cons);
    TEST_CALL_REPORT(&quot;procbl_get_assy_connectors &quot;, 
                   &quot;ProCblAssemblyConnectorsGet&quot;,(ProError)status, 0);
<a name="anchor-167"></a>	if (status != PRO_TK_NO_ERROR)
		return (status);

	ProArraySizeGet(*p_cons, num_cons);

<a name="anchor-168"></a>	return (PRO_TK_NO_ERROR);

}

/*---------------------------------------------------------------------------*\
<a name="anchor-169"></a>  Function : ProCblConnectorDesignate
  Purpose  : Designate specified connector
\*---------------------------------------------------------------------------*/
ProError ProCblConnectorDesignate (
    ProCblConnector  *p_connector,    /* In: connector to designate */
<a name="anchor-170"></a>    ProName          name)            /* In: The reference designator 
                                         of the logical connector,
                                         can be NULL */
{
    ProError error;
<a name="anchor-171"></a>
    if (p_connector == NULL)
        return (PRO_TK_BAD_INPUTS);

	error = ProConnectorDesignate((ProAsmcomppath*)p_connector, name);
<a name="anchor-172"></a>    TEST_CALL_REPORT(&quot;procbl_designate_connector&quot;, 
             &quot;ProCblConnectorDesignate&quot;,(ProError)error, 0);
	if (error != PRO_TK_NO_ERROR)
		return (error);
    return (PRO_TK_NO_ERROR);
<a name="anchor-173"></a>}

/*---------------------------------------------------------------------------*\
  Function : ProCblConnectorUndesignate
  Purpose  : Undesignate specified connector
<a name="anchor-174"></a>\*---------------------------------------------------------------------------*/
ProError ProCblConnectorUndesignate (
    ProCblConnector  *p_connector)    /* In: connector to undesignate */
{
    ProError error;
<a name="anchor-175"></a>
    if (p_connector == NULL)
        return (PRO_TK_BAD_INPUTS);

	error = ProConnectorUndesignate(p_connector);
<a name="anchor-176"></a>    TEST_CALL_REPORT(&quot;procbl_undesignate_connector&quot;, 
             &quot;ProCblConnectorUndesignate&quot;,(ProError)error, 0);
	if (error != PRO_TK_NO_ERROR)
		return (error);
    return (PRO_TK_NO_ERROR);
<a name="anchor-177"></a>}

/*---------------------------------------------------------------------------*\
  Function : ProCblConnectorEntryPortsGet
  Purpose  : Retrieves the entry ports for the specified connector
<a name="anchor-178"></a>\*---------------------------------------------------------------------------*/
ProError ProCblConnectorEntryPortsGet (
    ProCblConnector     *p_connector,      /* In: connector handle */
    int                 **p_csys_id_array, /* Out: ProArray of Csys ids */
    int                 *p_num_csys)       /* Out: csys number */
<a name="anchor-179"></a>{
    ProError error;
    int *p_id_array, i;
	ProCsys* p_csys_array;

<a name="anchor-180"></a>    if (p_connector == NULL || p_csys_id_array == NULL || p_num_csys == NULL)
        return (PRO_TK_BAD_INPUTS);

	error = ProConnectorEntryPortsGet(p_connector, &amp;p_csys_array);
    TEST_CALL_REPORT(&quot;procbl_get_connector_entry_ports&quot;, 
<a name="anchor-181"></a>               &quot;ProCblConnectorEntryPortsGet&quot;,(ProError)error, 0);

	if (error != PRO_TK_NO_ERROR)
		return (error);

<a name="anchor-182"></a>	ProArraySizeGet(p_csys_array, p_num_csys);
    ProArrayAlloc (*p_num_csys, sizeof (int), 1, (ProArray*)p_csys_id_array);

    for (i = 0; i &lt; *p_num_csys; i++)
	{
<a name="anchor-183"></a>		int id;
		error = ProCsysIdGet(p_csys_array[i], &amp;id);
        	(*p_csys_id_array)[i] = id;
	}

<a name="anchor-184"></a>    return (PRO_TK_NO_ERROR);
}


/*---------------------------------------------------------------------------*\
<a name="anchor-185"></a>    Functions to manage harnesses.
\*---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------*\
  Function : ProCblAssemblyHarnessesGet
  Purpose  : Retrive harnesses
<a name="anchor-186"></a>\*---------------------------------------------------------------------------*/
ProError ProCblAssemblyHarnessesGet (
    ProAssembly     asm_mdl,       /* In : assembly's handle */
    ProCblHarness **p_harness,     /* Out: array of harness handles to fill.
                                           User must free this with
<a name="anchor-187"></a>                                           ProArrayFree */
    int            *num_harness)   /* Out: Number of harness*/
{
    int error, i;
    ProError status;
<a name="anchor-188"></a>    ProMdlName name;
    ProHarness* harness;
  
    if (asm_mdl == NULL || p_harness == NULL || num_harness == NULL)
        return (PRO_TK_BAD_INPUTS);
<a name="anchor-189"></a>
	status = ProAssemblyHarnessesCollect(asm_mdl, &amp;harness);
    TEST_CALL_REPORT(&quot;ProAssemblyHarnessesCollect&quot;, 
          &quot;ProCblAssemblyHarnessesGet&quot;,(ProError)status, 0);
	if (status != PRO_TK_NO_ERROR)
<a name="anchor-190"></a>		return (status);

	ProArraySizeGet(harness, num_harness);
    status = ProArrayAlloc (*num_harness, sizeof(ProCblHarness), 1,
        (ProArray*)p_harness);
<a name="anchor-191"></a>
    for( i=0; i&lt;*num_harness; i++)
    {
        ProMdlMdlnameGet ((ProMdl)harness[i], name);
        status = ProCblHarnessInit ((ProPart)harness[i], name,
<a name="anchor-192"></a>            asm_mdl, &amp;(*p_harness)[i]);
    }

    return (PRO_TK_NO_ERROR);
}
<a name="anchor-193"></a>
/*---------------------------------------------------------------------------*\
  Function : ProCblHarnessInit
  Purpose  : Initialize harness structure
\*---------------------------------------------------------------------------*/
<a name="anchor-194"></a>ProError ProCblHarnessInit (
    ProPart        harness_mdl,  /* In: harness part */
    ProMdlName     name,         /* In: harness name */
    ProAssembly    asm_mdl,      /* In: harness owner */
    ProCblHarness  *p_harness)   /* Out: handle of harness to init */
<a name="anchor-195"></a>{
    if (p_harness == NULL)
        return (PRO_TK_BAD_INPUTS);
    p_harness->harness = harness_mdl;
    ProUtilWstrcpy (p_harness->name, name);
<a name="anchor-196"></a>    p_harness->owner = asm_mdl;

    return (PRO_TK_NO_ERROR);
}

<a name="anchor-197"></a>/*---------------------------------------------------------------------------*\
  Function : ProCblHarnessCreate
  Purpose  : Creates new harness
\*---------------------------------------------------------------------------*/
ProError ProCblHarnessCreate (
<a name="anchor-198"></a>    ProAssembly asm_mdl,         /* In : assembly's handle */
    ProName w_name,              /* In : harness name */
    ProCblHarness *p_harness)    /* Out: handle of harness to fill */
{
    ProError status;
<a name="anchor-199"></a>    int error;
    ProPart harness_part;
    ProHarness harness;

    if (asm_mdl == NULL || p_harness == NULL)
<a name="anchor-200"></a>        return (PRO_TK_BAD_INPUTS);

	status = ProHarnessCreate(asm_mdl, w_name, &amp;harness);
    TEST_CALL_REPORT(&quot;procbl_create_harness&quot;, 
             &quot;ProCblHarnessCreate&quot;,(ProError)status, 0);
<a name="anchor-201"></a>
	if (status != PRO_TK_NO_ERROR)
		return (status);

    status = ProCblHarnessInit (harness, w_name, asm_mdl, p_harness); 
<a name="anchor-202"></a>    return (status);
}

/*---------------------------------------------------------------------------*\
  Function : ProCblHarnessNameGet
<a name="anchor-203"></a>  Purpose  : Retrive the name of harness
\*---------------------------------------------------------------------------*/
ProError ProCblHarnessNameGet (
    ProCblHarness *p_harness,    /* In : harness*/
    ProName       w_name)        /* Out: harness name*/
<a name="anchor-204"></a>{
    if (p_harness == NULL)
        return (PRO_TK_BAD_INPUTS);
    ProUtilWstrcpy (w_name, p_harness->name);
    return (PRO_TK_NO_ERROR);
<a name="anchor-205"></a>}

/*---------------------------------------------------------------------------*\
  Function : ProCblHarnessCablesGet 
  Purpose  : Get cables from specified harness
<a name="anchor-206"></a>\*---------------------------------------------------------------------------*/
ProError ProCblHarnessCablesGet (
    ProCblHarness *p_harness,    /* In : harness*/
    ProCblCable   **p_cables,    /* Out: ProArray of cables, (user must call
                                         ProArrayFree)*/
<a name="anchor-207"></a>    int           *p_n_cables)     /* Out: number of cables */
{
    int error, i, cable_id;
    ProName *p_cables_names;
	ProError status;
<a name="anchor-208"></a>	ProCable* cables;

    if (p_harness == NULL || p_cables == NULL || p_n_cables == NULL)
        return (PRO_TK_BAD_INPUTS);

<a name="anchor-209"></a>	status = ProHarnessCablesCollect(p_harness->harness, &amp;cables);
    TEST_CALL_REPORT(&quot;procbl_get_harness_cables&quot;, 
              &quot;ProCblHarnessCablesGet&quot;,(ProError)status, 0);

	if (status != PRO_TK_NO_ERROR)
<a name="anchor-210"></a>		return (status);

	ProArraySizeGet(cables, p_n_cables);
    ProArrayAlloc (*p_n_cables, sizeof (ProCblCable), 1, (ProArray*)p_cables);

<a name="anchor-211"></a>    for (i = 0; i &lt; *p_n_cables; i++)
    {
		ProName cable_name;

		status = ProCableNameGet(&amp;cables[i], cable_name);
<a name="anchor-212"></a>        TEST_CALL_REPORT(&quot;procbl_get_cable_id&quot;, 
            &quot;ProCblHarnessCablesGet&quot;,(ProError)status, 0);
        if (status != PRO_TK_NO_ERROR)
            break;
        ProCblCableInit (cables[i].id, cable_name, p_harness,
<a name="anchor-213"></a>            &amp;(*p_cables)[i]);
    }
    if (status != PRO_TK_NO_ERROR)
    {
        ProArrayFree ((ProArray*)p_cables);
<a name="anchor-214"></a>        return (status);
    }
    return (PRO_TK_NO_ERROR);
}

<a name="anchor-215"></a>/*---------------------------------------------------------------------------*\
  Function : ProCblHarnessLocationsGet
  Purpose  : Finds the locations for the specified harness
\*---------------------------------------------------------------------------*/
ProError ProCblHarnessLocationsGet (
<a name="anchor-216"></a>    ProCblHarness   *p_harness,      /* In: harness handle */
    int **p_location_array,          /* Out: ProArray of locations */
    int  *n_locations)               /* Out: locations number */ 
{
    int error, i;
<a name="anchor-217"></a>    int *p_locations;
	ProError status;
	ProCablelocation* p_cable_loc_array;

    if (p_harness == NULL || p_location_array == NULL || n_locations == NULL)
<a name="anchor-218"></a>        return (PRO_TK_BAD_INPUTS);

	status = ProHarnessLocationsCollect(p_harness->owner, p_harness->harness, &amp;p_cable_loc_array);
    TEST_CALL_REPORT(&quot;procbl_get_harness_locations&quot;, 
              &quot;ProCblHarnessLocationsGet&quot;,(ProError)status, 0); 
<a name="anchor-219"></a>	if (status != PRO_TK_NO_ERROR)
		return (status);

	ProArraySizeGet(p_cable_loc_array, n_locations);

<a name="anchor-220"></a>    ProArrayAlloc (*n_locations, sizeof (int), 1, (ProArray*)p_location_array);
    for (i = 0; i &lt; *n_locations; i++)
        (*p_location_array)[i] = p_cable_loc_array[i].id;

    return (PRO_TK_NO_ERROR);
<a name="anchor-221"></a>}

/*---------------------------------------------------------------------------*\
  Function : ProCblHarnessLocationTypeGet
  Purpose  : Retrieve location type of specified harness
<a name="anchor-222"></a>\*---------------------------------------------------------------------------*/
ProError ProCblHarnessLocationTypeGet (
    ProCblHarness    *p_harness,        /* In: harness handle */
    int              location_id,       /* In: location id */
    ProCablelocationType  *type)          /*Out: location type */ 
<a name="anchor-223"></a>{
    ProError error;
    ProCablelocation location;

    if (p_harness == NULL || type == NULL)
<a name="anchor-224"></a>        return (PRO_TK_BAD_INPUTS);

	error = ProModelitemInit(p_harness->harness, location_id, PRO_CABLE_LOCATION, &amp;location);
	error = ProCablelocationTypeGet(&amp;location, type);
    TEST_CALL_REPORT(&quot;procbl_get_location_type&quot;, 
<a name="anchor-225"></a>       &quot;ProCblHarnessLocationTypeGet&quot;,(ProError)error, 0);  

	if (error != PRO_TK_NO_ERROR)
		return (error);

<a name="anchor-226"></a>    return (PRO_TK_NO_ERROR);
}

/*---------------------------------------------------------------------------*\
  Function : ProCblHarnessLocationPntGet
<a name="anchor-227"></a>  Purpose  : Retrieve location point of specified harness
\*---------------------------------------------------------------------------*/
ProError ProCblHarnessLocationPntGet (
    ProCblHarness    *p_harness,        /* In: harness handle */
    int              location_id,       /* In: location id */
<a name="anchor-228"></a>    ProPoint3d pnt,				/*Out: The cable location's point */
	ProVector tan)            /*Out: The cable location's vector */
{
    ProError error;
    ProCablelocation location;
<a name="anchor-229"></a>
    if (p_harness == NULL || pnt == NULL)
        return (PRO_TK_BAD_INPUTS);

	error = ProModelitemInit(p_harness->harness, location_id, PRO_CABLE_LOCATION, &amp;location);
<a name="anchor-230"></a>	error = ProCablelocationPointGet(&amp;location, pnt, tan);
    TEST_CALL_REPORT(&quot;procbl_get_location_pnt&quot;, 
       &quot;ProCblHarnessLocationPntGet&quot;,(ProError)error, 0);

	if (error != PRO_TK_NO_ERROR)
<a name="anchor-231"></a>		return (error);
    return (PRO_TK_NO_ERROR);
}

    
<a name="anchor-232"></a>
/*---------------------------------------------------------------------------*\
    Functions to manage spools.
\*---------------------------------------------------------------------------*/

<a name="anchor-233"></a>/*---------------------------------------------------------------------------*\
  Function : ProCblAssemblySpoolsGet
  Purpose  : Collect spools in specified assembly
\*---------------------------------------------------------------------------*/
ProError ProCblAssemblySpoolsGet (
<a name="anchor-234"></a>    ProAssembly    asm_mdl,     /* In : assembly's handle*/
    ProCblSpool    **p_spool,   /* Out: pointer on array of spool's handle's
                                       to init.Function allocate memory for
                                       this argument, use ProArrayFree to free
                                       it.*/
<a name="anchor-235"></a>    int            *num_spools) /* Out: number of retrieved spools*/
{
    int error, i;
    ProError status;
    ProName *spool_names;
<a name="anchor-236"></a>
    if (asm_mdl == NULL || p_spool == NULL)
        return (PRO_TK_BAD_INPUTS);

	status = ProAssemblySpoolsCollect(asm_mdl, (ProSpool**)p_spool);
<a name="anchor-237"></a>    TEST_CALL_REPORT(&quot;procbl_get_assy_spools&quot;, 
           &quot;ProCblAssemblySpoolsGe&quot;,(ProError)status, 0);
	if (status != PRO_TK_NO_ERROR)
		return (status);

<a name="anchor-238"></a>	ProArraySizeGet(*p_spool, num_spools);

    return (PRO_TK_NO_ERROR);
}

<a name="anchor-239"></a>/*---------------------------------------------------------------------------*\
  Function : ProCblSpoolInit
  Purpose  : Initializes spool structure
\*---------------------------------------------------------------------------*/
ProError ProCblSpoolInit (
<a name="anchor-240"></a>    ProAssembly    asm_mdl,     /* In : assembly's handle*/
    ProName        w_name,      /* In : spool name*/
    ProCblSpool    *p_spool)    /* Out: handle of spool to init*/
{
    if (asm_mdl == NULL || p_spool == NULL)
<a name="anchor-241"></a>        return (PRO_TK_BAD_INPUTS);
    p_spool->owner = asm_mdl;
    ProUtilWstrcpy (p_spool->name, w_name);
    return (PRO_TK_NO_ERROR);
}
<a name="anchor-242"></a>
/*---------------------------------------------------------------------------*\
  Function : ProCblSpoolNameGet
  Purpose  : returns spool name
\*---------------------------------------------------------------------------*/
<a name="anchor-243"></a>ProError ProCblSpoolNameGet (
    ProCblSpool    *p_spool,    /* In: handle of spool to init*/
    ProName        w_name)      /* Out: spool name*/
{
    ProUtilWstrcpy(w_name, p_spool->name);
<a name="anchor-244"></a>    return (PRO_TK_NO_ERROR);
}

/*---------------------------------------------------------------------------*\
  Function : ProCblSpoolCreate
<a name="anchor-245"></a>  Purpose  : Creates new spool
\*---------------------------------------------------------------------------*/
ProError ProCblSpoolCreate (
    ProAssembly assy,                  /* In : assembly's handle*/
    ProName     w_name,                /* In : harness name*/
<a name="anchor-246"></a>    ProCableType cable_type,      /* In : cable type */
    ProBundleType sheath_type,    /* In : bundle type */
    ProCblSpool  *p_spool)             /* Out :user's memory */
{
    ProError status;
<a name="anchor-247"></a>    int error;

    if (assy == NULL || p_spool == NULL)
        return (PRO_TK_BAD_INPUTS);

<a name="anchor-248"></a>	status = ProSpoolCreate(assy, w_name, cable_type, sheath_type, (ProSpool*)p_spool);
    TEST_CALL_REPORT(&quot;procbl_create_spool&quot;, 
             &quot;ProCblSpoolCreate&quot;,(ProError)status, 0);

	if (status != PRO_TK_NO_ERROR)
<a name="anchor-249"></a>		return (status);

    return (PRO_TK_NO_ERROR);
}

<a name="anchor-250"></a>/*---------------------------------------------------------------------------*\
  Function : ProCblSpoolParametersGet
  Purpose  : Retrieves parameters of specified spool
\*---------------------------------------------------------------------------*/
ProError ProCblSpoolParametersGet (
<a name="anchor-251"></a>    ProCblSpool *p_spool,             /* In : spool's handle*/
    ProCableparam **p_param)    /* Out: ProArray */
{
    ProError error;

<a name="anchor-252"></a>    if (p_spool == NULL || p_param == NULL)
        return (PRO_TK_BAD_INPUTS);

	error = ProSpoolParametersCollect((ProSpool*)p_spool, p_param);
    TEST_CALL_REPORT(&quot;procbl_get_spool_params&quot;, 
<a name="anchor-253"></a>          &quot;ProCblSpoolParametersGet&quot;,(ProError)error, 0);
	if (error != PRO_TK_NO_ERROR)
		return (error);


<a name="anchor-254"></a>    return (PRO_TK_NO_ERROR);
}

/*---------------------------------------------------------------------------*\
  Function : ProCblSpoolParameterGet
<a name="anchor-255"></a>  Purpose  : Retrieves one parameter of specified spool
\*---------------------------------------------------------------------------*/
ProError ProCblSpoolParameterGet (
    ProCblSpool *p_spool,            /* In : spool's handle*/
    ProName w_param_name,            /* In : parametr name */
<a name="anchor-256"></a>    ProCableparam *p_param)    /* Out: user's memory */
{
    ProError error;

    if (p_spool == NULL || p_param == NULL)
<a name="anchor-257"></a>        return (PRO_TK_BAD_INPUTS);

	error = ProSpoolParameterGet((ProSpool*)p_spool, w_param_name, p_param);
    TEST_CALL_REPORT(&quot;procbl_get_spool_param &quot;, 
            &quot;ProCblSpoolParameterGet&quot;,(ProError)error, 0);
<a name="anchor-258"></a>
	if (error != PRO_TK_NO_ERROR)
		return (error);

    return (PRO_TK_NO_ERROR);
<a name="anchor-259"></a>}

/*---------------------------------------------------------------------------*\
  Function : ProCblSpoolParametersSet
  Purpose  : Set parameters for specified spool
<a name="anchor-260"></a>\*---------------------------------------------------------------------------*/
ProError ProCblSpoolParametersSet (
    ProCblSpool         *p_spool,/* In : spool*/
    ProCableparam *p_param)/* In : the ProArray of parameters*/
{
<a name="anchor-261"></a>	ProError error;

	if (p_spool == NULL || p_param == NULL)
		return (PRO_TK_BAD_INPUTS);

<a name="anchor-262"></a>	error = ProSpoolParametersSet((ProSpool*)p_spool, p_param );
	TEST_CALL_REPORT(&quot;procbl_set_spool_params&quot;, 
		&quot;ProCblSpoolParametersSet&quot;,(ProError)error, 0);

	if (error != PRO_TK_NO_ERROR)
<a name="anchor-263"></a>		return (error);
	return (PRO_TK_NO_ERROR);
}

/*---------------------------------------------------------------------------*\
<a name="anchor-264"></a>  Function : ProCblSpoolParameterDelete
  Purpose  : Deletes parameter in specified spool
\*---------------------------------------------------------------------------*/
ProError ProCblSpoolParameterDelete (
    ProCblSpool *p_spool,       /* In : spool*/
<a name="anchor-265"></a>    ProName   param_name)       /* In : param name*/
{
    ProError error;

    if (p_spool == NULL)
<a name="anchor-266"></a>        return (PRO_TK_BAD_INPUTS);

	error = ProSpoolParameterDelete((ProSpool*)p_spool, param_name);
    TEST_CALL_REPORT(&quot;procbl_delete_spool_param&quot;, 
          &quot;ProCblSpoolParameterDelete&quot;,(ProError)error, 0);
<a name="anchor-267"></a>	
	if (error != PRO_TK_NO_ERROR)
		return (error);

    return (PRO_TK_NO_ERROR);
<a name="anchor-268"></a>}

/*---------------------------------------------------------------------------*\
  Function : ProCblSpoolFromLogicalGet
  Purpose  : Return list of imported, but not created spools
<a name="anchor-269"></a>\*---------------------------------------------------------------------------*/
ProError ProCblSpoolFromLogicalGet (
    ProAssembly assy,             /* In: assemlbly */
    ProName     **p_w_name,       /* Out:  ProArray of spool names*/
    int         *num_spool)       /* Out: number of spools */
<a name="anchor-270"></a>{
    ProError status;
    int error, i;
    ProName *p_spool_names;

<a name="anchor-271"></a>    if (assy == NULL || num_spool == NULL || p_w_name == NULL)
        return (PRO_TK_BAD_INPUTS);

	status = ProSpoolsFromLogicalGet(assy, p_w_name);
    TEST_CALL_REPORT(&quot;procbl_get_spools_from_logical&quot;, 
<a name="anchor-272"></a>                &quot;ProCblSpoolFromLogicalGet&quot;,(ProError)status, 0);                               
	
	if (status != PRO_TK_NO_ERROR)
		return (status);

<a name="anchor-273"></a>	ProArraySizeGet(*p_w_name, num_spool);

    return (PRO_TK_NO_ERROR);
}

<a name="anchor-274"></a>/*---------------------------------------------------------------------------*\
  Function : ProCblSpoolFromLogicalCreate
  Purpose  : creates spools from logical
\*---------------------------------------------------------------------------*/
ProError ProCblSpoolFromLogicalCreate (
<a name="anchor-275"></a>    ProAssembly assy,                /* In: assembly's hndle*/
    ProName    *p_w_name,            /* In: spool_names */
    int        spool_num,            /* In: spool num */
    ProCblSpool   **p_spools)        /* Out: ProArray of spools
                                        user must free memory by ProArrayFree*/
<a name="anchor-276"></a>{
    ProName *p_spool_names;
    int error, i;
    ProError status;
  
<a name="anchor-277"></a>    if (assy == NULL || p_w_name == NULL || p_spools == NULL)
        return (PRO_TK_BAD_INPUTS);
 
    status = ProSpoolsFromLogicalCreate(assy, p_w_name, (ProSpool**) p_spools);
    TEST_CALL_REPORT(&quot;procbl_create_spools_from_logical&quot;, 
<a name="anchor-278"></a>                &quot;ProCblSpoolFromLogicalCreate&quot;,(ProError)status, 0);

    if (status != PRO_TK_NO_ERROR)
	return (status);

<a name="anchor-279"></a>    
    return (PRO_TK_NO_ERROR);
}

/*---------------------------------------------------------------------------*\
<a name="anchor-280"></a>    Functions to route cables.
\*---------------------------------------------------------------------------*/

/*---------------------------------------------------------------------------*\
  Function : ProCblRoutingStart
<a name="anchor-281"></a>  Purpose  : Initializes routing procedure
\*---------------------------------------------------------------------------*/
ProError ProCblRoutingStart (
    ProCblCable    *p_cables,       /* In: ProArray of cables to route */
    void      **p_cable_route_data) /* Out: The cable routing data required for
<a name="anchor-282"></a>                          subsequent function calls to route cables
                          through locations. The function allocates
                          the space for this argument. */
{
    ProError error;
<a name="anchor-283"></a>    ProName *cable_names;
    int cable_num, i;
	ProCable * cables;

    if (p_cables == NULL || p_cable_route_data == NULL)
<a name="anchor-284"></a>        return (PRO_TK_BAD_INPUTS);

    ProArraySizeGet ((ProArray)p_cables, &amp;cable_num);

	ProArrayAlloc (0, sizeof (ProCable), 1, (ProArray*)&amp;cables);
<a name="anchor-285"></a>	for (i = 0; i &lt; cable_num; i++)
	{
		ProModelitem item;
		error = ProModelitemInit(p_cables[i].p_owner->harness, p_cables[i].id, PRO_CABLE, &amp;item);
		error = ProArrayObjectAdd((ProArray*)&amp;cables, i , 1, &amp;item);
<a name="anchor-286"></a>	}
	
	error = ProCableRoutingStart(p_cables[0].p_owner->owner, cables, p_cable_route_data);
    TEST_CALL_REPORT(&quot;procbl_routing_start&quot;, 
             &quot;ProCblRoutingStart&quot;,(ProError)error, 0);
<a name="anchor-287"></a>
	if (error != PRO_TK_NO_ERROR)
		return (error);

    return (PRO_TK_NO_ERROR);
<a name="anchor-288"></a>}

/*---------------------------------------------------------------------------*\
  Function : ProCblRouteThruLocation
  Purpose  : Finds or creates the location, and routes cables through it
<a name="anchor-289"></a>\*---------------------------------------------------------------------------*/
ProError ProCblRouteThruLocation (
    void      *p_cable_route_data, /* In: routing data */
    ProCablelocationref ref,       /* In: referances */
    ProCablelocation* p_location,  /* Out: The location. */
<a name="anchor-290"></a>    ProCablelocation* second_axis_location) /* Out: If routing through an axis, the route generates two locations. Otherwise,this is NULL. */
{
    ProError error;

    if (p_cable_route_data == NULL || ref == NULL || p_location == NULL)
<a name="anchor-291"></a>        return (PRO_TK_BAD_INPUTS);

	error = ProCableThruLocationRoute(p_cable_route_data, ref, p_location, second_axis_location);
    TEST_CALL_REPORT(&quot;procbl_route_thru_location&quot;, 
              &quot;ProCblRouteThruLocation&quot;,(ProError)error, 0);
<a name="anchor-292"></a>
	if (error != PRO_TK_NO_ERROR)
		return (error);

    return (PRO_TK_NO_ERROR);
<a name="anchor-293"></a>}

/*---------------------------------------------------------------------------*\
  Function : ProCblRoutingEnd
  Purpose  : Ends the cable routing
<a name="anchor-294"></a>\*---------------------------------------------------------------------------*/
ProError ProCblRoutingEnd (
    void      **p_cable_route_data)   /* In: The address of the cable 
                                         routing data */
{
<a name="anchor-295"></a>	ProError error;

	if (p_cable_route_data == NULL)
		return (PRO_TK_BAD_INPUTS);

<a name="anchor-296"></a>	error = ProCableRoutingEnd(p_cable_route_data);
	TEST_CALL_REPORT(&quot;procbl_routing_end&quot;, 
		&quot;ProCblRoutingEnd&quot;,(ProError)error, 0);
	if (error != PRO_TK_NO_ERROR)
		return (error);
<a name="anchor-297"></a>	return (PRO_TK_NO_ERROR);
}

</pre>
</body>
</html>
